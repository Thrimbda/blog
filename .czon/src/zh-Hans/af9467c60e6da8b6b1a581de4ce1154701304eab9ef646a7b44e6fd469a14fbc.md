---
"title": "Zola博客实时编辑与后端方案设计"
"summary": "本文档详细分析了Zola博客站点的现状，包括技术栈、设计语言和内容特性，并针对实现WYSIWYG
  Markdown实时编辑功能进行了方案设计。核心推荐使用Vditor作为编辑器，Supabase作为后端存储与鉴权方案，强调无需引入构建链，保持现有极简J\
  S风格和suCSS设计语言。文档还探讨了编辑范围、发布链路等关键决策点，并提供了编辑器与后端的备选方案，确保方案与现有工程匹配且易于实施。"
"tags":
  - "Zola"
  - "Markdown"
  - "WYSIWYG"
  - "Supabase"
  - "实时编辑"
  - "博客"
  - "前端"
  - "设计"
"date": "2026-01-06"
---

# Zola 博客：WYSIWYG Markdown 实时编辑 + Supabase/GitHub 后端方案设计 - 上下文

## 会话进展 (2026-01-06)

### ✅ 已完成

- 现状初步审计：项目为 Zola 站点，主题基于 anemone + suCSS，当前 JS 极少且允许 CDN 依赖。

### 🟡 进行中

- 输出可 review 的详细设计（编辑器/后端选型 + 发布/同步流程 + 落地步骤）。

### ⚠️ 阻塞/待定

- “实时编辑”的准确含义（实时预览 vs 自动保存 vs 多人协作）。
- 编辑范围（只编辑少量页面/单文件，还是全站 content）。
- 发布链路（仅存草稿 vs 同步到 `content/` 触发 Zola 构建）。

---

## 关键文件

- `config.toml`：站点配置与导航；默认主题为 light，支持多语言。
- `templates/head.html`：全站引入 `static/css/reset.css`、`static/css/suCSS.css`、`static/css/style.css` 与 `static/js/script.js`，并通过 CDN 引入 `rxjs`、`highlight.js`、`mermaid`。
- `static/css/suCSS.css`：设计 token（CSS variables）与基础组件样式（表单、按钮、表格等）；含 light/dark theme 变量。
- `static/css/style.css`：站点自定义样式（导航、footer、slider、短代码样式等）。
- `static/js/script.js`：主题切换（`data-theme` + localStorage）与 slider 交互；可复用到 admin 页面以保持一致体验。
- `content/**`：Markdown 内容源；包含 YAML front matter（`---`）与短代码（如 `{{ slideshow(...) }}`）。

---

## 关键决策

| 决策 | 原因 | 替代方案 | 日期 |
|------|------|----------|------|
| 默认推荐“纯 JS admin 页面 + Supabase 存储/鉴权”，编辑器优先评估 Vditor | 当前工程无 Node/React 构建链；已有 CDN 依赖惯例；Vditor 提供 WYSIWYG/IR/SV 三模式与“浏览器端 Markdown 编辑器”定位，集成成本最低 | React + shadcn + Milkdown/TipTap；或 GitHub Discussion/Issue 作为后端 | 2026-01-06 |

---

## 现状审计摘要

### 技术栈/部署

- 站点为 Zola（`config.toml`），GitHub Actions 使用 `shalzz/zola-deploy-action` 部署到 `gh-pages`（`.github/workflows/*.yaml`）。
- 站点偏“极简 JS”：当前全站脚本为 `static/js/script.js`，其余为 CDN（`rxjs`、`highlight.js`、`mermaid`）。

### 主题与设计语言（必须保持）

- 视觉基于 `suCSS.css` 的 CSS variables：`--bg/--bg-light/--text/--text-light/--accent/--accent-light/--link/--border` 等。
- 主题切换机制：`document.documentElement[data-theme="light"|"dark"]`，并与 `prefers-color-scheme` + localStorage 同步（见 `static/js/script.js`）。
- 组件风格：按钮/表单/表格/列表 marker 等均在 `suCSS.css` 中定义；新增 UI 应优先复用这些语义元素与变量，而非引入新的 design system。

### 内容特性（影响编辑器）

- Markdown 可能包含：
  - YAML front matter（示例：`content/gcores-talks.md`）
  - Zola shortcodes（示例：`{{ slideshow(...) }}`，模板位于 `templates/shortcodes/*`）
  - 高亮代码块、mermaid 代码块
- 风险点：WYSIWYG 编辑器若试图“理解/渲染”短代码，可能会改写或吞掉原文；需要选择“对未知语法保持原样”的编辑器/模式，或在 editor 中提供“源码模式”兜底。

---

## 编辑器调研（上网 + 资料）

> 目标：可嵌入、支持 WYSIWYG（富文本/所见即所得）且能输出 Markdown；最好无需构建链（纯 JS/CDN）。

| 候选 | 定位/模式 | 集成形态 | 主题/定制 | 关键点 | 适配本项目结论 |
|---|---|---|---|---|---|
| **Vditor** | 浏览器端 Markdown 编辑器；支持 WYSIWYG/IR(类似 Typora)/SV 分屏 | 原生 JS；官网与 CDN 形态成熟（页面文案明确强调三种模式） | 自带主题与可配置项较多；可通过 CSS variables 贴近 suCSS | 支持实时保存、粘贴/拖拽上传等能力（见官网页面说明）；MIT License（`https://unpkg.com/vditor@3.10.4/LICENSE`） | **首推**：与“无构建链 + 实时编辑”匹配度最高；需重点验证“短代码/Front matter 不被破坏” |
| **TOAST UI Editor** | Markdown/WYSIWYG 双模式 | CDN（`uicdn.toast.com/editor/latest/...`）或 npm | 有 theme/样式体系；可通过自定义 CSS 做适配 | 文档明确支持 CDN 与 `usageStatistics` 关闭（`https://unpkg.com/@toast-ui/editor@3.2.2/README.md`） | 备选：成熟但样式体系更“重”，主题贴合 suCSS 成本可能更高；license 待在集成时再确认 |
| **Milkdown** | 插件化 WYSIWYG Markdown editor（Typora 风格），ProseMirror + remark | 通常需要 bundler（React/Vue 等） | 可深度定制，但工程化成本高 | README 明确其 WYSIWYG Markdown 定位与 MIT（`https://raw.githubusercontent.com/Milkdown/milkdown/main/README.md`） | 适合“要上 React/shadcn”时作为候选；与当前 Zola 工程不匹配（需要引入构建链） |
| **TipTap** | 富文本编辑器 toolkit（更偏 HTML/Schema） | React/Vue/Svelte 等 | 定制强，但 Markdown 往往需要额外转换与约束 | 官方站强调“real time collaboration”等，但 Markdown-first 不是核心 | 不推荐作为第一选择（Markdown 与短代码场景复杂） |

---

## 后端调研（免手写后端）

| 方案 | 是否需要自建服务 | 鉴权/权限 | 存储/历史 | 与 Zola 发布关系 | 结论 |
|---|---|---|---|---|---|
| **Supabase** | 否（托管 DB/Auth/Storage） | 前端直连 + RLS；anon key 可公开 | DB 行级历史需自建（可做 revisions 表） | 需要“同步到 repo/content”才能影响静态站点 | **推荐默认**：实现最直接；安全边界清晰（RLS）；图片存储也容易 |
| **GitHub Issue/Discussion** | 理论可无服务，但实际常需要 OAuth token 交换服务 | OAuth 流程复杂（纯前端难安全处理 token 交换） | GitHub 天然有历史/审计 | 同步到站点仍需脚本将 issue/discussion 转为 `content/` | 备选：如果你强烈希望“内容即 GitHub 数据”，可考虑；但鉴权/上传/同步复杂度更高 |

补充：GitHub Docs 的 OAuth web flow 在“用 code 换 access token”步骤中明确要求同时提供 `client_id` 与 `client_secret`，这使得“纯前端直连 GitHub 作为写入后端”在安全上很难成立（除非引入 token 交换服务或改用 device flow 等受限方案）。

---

## 快速交接

**下次继续从这里开始：**

1. 在 `plan.md` 确认“实时编辑/编辑范围/发布链路”的默认假设与需要你 review 的决策点。
2. 基于你的反馈，在三套方案（Supabase / GitHub Discussions / React 化）中做最终推荐与落地步骤固化。

**注意事项：**

- 任何 UI（包含 admin）必须复用 `suCSS.css` 的 CSS variables 与 light/dark 机制，不引入破坏风格的新主题体系。
- 需要重点验证：编辑器是否会改写 Zola shortcodes 与 front matter。

---

*最后更新: 2026-01-06 20:30 by Codex*
