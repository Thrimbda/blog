---
"title": "Zola博客实时编辑与GitHub后端整合方案设计"
"summary": "本文详细规划了为Zola博客在不破坏现有CSS设计风格的前提下，设计一个可实时编辑Markdown的WYSIWYG编辑器与“免手写后端\
  ”整合方案。文档明确了设计原则，包括保持现有视觉语言、尽量不引入手写后端、支持实时预览与自动保存等。通过现状审计，确认项目为Zola站点，无Node/Re\
  act构建链，内容源为Markdown文件。在候选方案中，主推方案D：纯JS /admin + Vditor + GitHub Device Flow +
  PR发布，实现无自建后端、以GitHub为真相源、草稿仅本机缓存、图片存回repo的完整流程。文档还涵盖了安全风险、范围界定和阶段概览，最终推荐落地步骤基\
  于默认假设，确保方案可行且符合用户偏好。"
"tags":
  - "Zola"
  - "Markdown"
  - "WYSIWYG"
  - "GitHub"
  - "实时编辑"
  - "无后端"
  - "前端开发"
  - "博客优化"
"date": "2026-01-06"
---

# Zola 博客：WYSIWYG Markdown 实时编辑 + Supabase/GitHub 后端方案设计

## 目标

为当前 Zola 博客在不破坏现有 CSS 设计风格的前提下，设计并规划一个可实时编辑 Markdown 的 WYSIWYG 编辑器与“免手写后端”(Supabase 或 GitHub Issue/Discussion)的整合方案。

## 设计原则（必须遵守）

- 保持现有 suCSS + CSS variables 视觉语言（含 light/dark theme 切换）
- 尽量不引入手写后端；首选前端直连 Supabase 或 GitHub API
- 若需 React/shadcn，须给出引入构建链的理由、成本与回滚方案
- 编辑体验需支持实时预览/渲染与自动保存（至少草稿）
- 明确内容发布到 Zola 的同步路径（不破坏现有 content 结构）

## 现状摘要（来自审计）

- 本项目是 Zola 站点（无 Node/React 构建链），全站 CSS/JS 走 `static/`，并允许在 `templates/head.html` 中引入 CDN 依赖。
- 主题/颜色完全由 `static/css/suCSS.css` 的 CSS variables 驱动；JS 通过 `data-theme` 切换 light/dark（`static/js/script.js`）。
- 内容源为 `content/**` Markdown；包含 YAML front matter（`---`）与 Zola shortcodes（如 `{{ slideshow(...) }}`）。

## 你需要 review 的不确定点（请回答/选择）

1. **编辑范围**：只需要编辑某一个/少数几个文件（例如 `content/gcores-talks.md`）还是希望“可编辑任意 `content/**` 页面”？
2. **实时编辑**：你的“实时”指的是：
   - A) 编辑器内实时预览/渲染即可（单人）
   - B) 需要后台自动保存草稿（单人）
   - C) 需要多人协作/同屏编辑（多用户）
3. **发布链路**：编辑结果最终希望如何影响站点？
   - A) 仅保存为草稿库（不自动进入 `content/`）
   - B) 一键发布：自动同步到 repo 的 `content/` 并触发 Zola 构建
   - C) 半自动：导出文件/生成 patch，你手动提交
4. **鉴权**：admin 只给你自己用，是否接受 “Supabase email magic link + allowlist 单用户”？
5. **图片**：是否需要在编辑器里直接上传图片？如果需要，是否接受图片存到 Supabase Storage 并在 Markdown 中引用外链？

> [REVIEW]
> 1. 我要编辑任意文件，然后通过某种方式提交到 github repo 里，如果需要后端可以论证后端的必要性
> 2. A and B
> 3. B
> 4. 这个版本只要我自己用，只要 admin 就好，只要保证安全就好，我甚至可以接受我有一个椭圆曲线密钥对，然后我用这个密钥对鉴权，就像 ssh 一样
> 5. 需要上传图片，并且希望图片存到 repo 里
> 
> [RESPONSE] 收到，我按你的回答把默认假设/方案取向调整为：
> 
> 1) 编辑范围：改为“可编辑任意 `content/**` 文件”（并允许扩展到 `templates/**` 等，但 MVP 先锁定 `content/**` 以减少风险）。发布路径以“写回 GitHub repo”为核心目标；不再以 Supabase 作为真相源。
> 
> 2) 实时编辑：选择 A + B —— 编辑器内实时渲染/预览 + 自动保存（draft）。
> 
> 3) 发布链路：选择 B —— 一键把编辑结果提交到 GitHub（建议走 PR 而不是直接 push master，便于你 review/回滚；如果你坚持直推也可做成选项）。
> 
> 4) 鉴权：MVP 仅你自己用。你提到“椭圆曲线密钥对像 SSH”这个方向可以作为本地凭证保护（例如：用你的私钥解密存储在 IndexedDB 的 GitHub token，或作为解锁步骤）。但真正对 GitHub 写入仍需要 GitHub 授权 token；为满足“尽量不需要后端”，我倾向用 GitHub OAuth *device flow*（不依赖 `client_secret`）在纯前端完成授权，然后把 token 仅存本地并可用你的私钥二次加密。
> 
> 5) 图片：按你的偏好，图片也存到 repo（例如写入 `static/images/uploads/...`，在 Markdown 中引用 `/images/uploads/...`）；上传实现上是“用同一个 GitHub token 通过 API 创建 blob/commit”，不需要额外后端。
> 
> 我下一步会把 plan 里的“默认推荐 A(Supabase 真相源)”改成“GitHub 真相源 + Discussions/Issues 存草稿 + PR 发布”，并在设计里补上 token 存储/加密与图片写入 repo 的细节与限制（单文件大小、频繁 autosave 的 commit 策略等）。
> [STATUS:resolved]

> [REVIEW] 如果可以的话 device flow 我觉得可以接受，那么就可以不用密钥对，我可以信任我自己的设备。
> 
> [RESPONSE] OK，接受 device flow 的前提下，我们可以把“椭圆曲线密钥对”从 MVP 中移除：
> - 以 GitHub OAuth device flow 获取写 repo 的 access token
> - token 仅保存在本机（IndexedDB/localStorage），你信任自己的设备即可
> - 后续如果你想要“二次解锁/防本机旁观者”，再把密钥对/OS Keychain 作为 v2 可选增强
> [STATUS:resolved]

## 候选方案（高层架构）

### 方案 D（当前实现 / 主方案）：纯 JS `/admin` + Vditor + GitHub Device Flow + PR 发布

- **前端**：`static/admin/*` 静态页面，复用现有 `reset.css`/`suCSS.css`/`style.css` 与 `static/js/script.js` 的 theme toggle（保持设计语言一致）。
- **编辑器**：Vditor（默认 IR），正文编辑 + front matter 单独编辑（避免 WYSIWYG 破坏）。
- **鉴权**：GitHub OAuth **device flow**（无需 `client_secret`，不需要自建 token exchange 后端）；token 仅保存在本机 IndexedDB。
- **草稿**：仅本机 autosave（IndexedDB），不跨设备同步，不产生 Git commit 噪音。
- **发布**：发布时创建分支 + PR，一次性写入：
  - `content/**.md`（合并 front matter + body）
  - `static/images/uploads/**`（插入图片时登记为 pending assets，发布时一起提交）

优点：完全无自建后端；“真相源”就是 GitHub repo；与你的偏好一致。  
风险：需要验证编辑器对 shortcodes/front matter 的“保真”（尤其含 `{{ ... }}` 的页面）；需要控制 GitHub API 的权限范围（scope）。

### 方案 A（可选）：纯 JS `/admin` + Vditor + Supabase（仅草稿/跨设备）

仅当你未来需要“跨设备草稿同步/协作”时再引入；不作为真相源。

### 方案 B（可选）：纯 JS `/admin` + TOAST UI Editor

如果你更偏好 TOAST UI 的编辑体验，可替换编辑器（需要额外主题覆写成本）。

### 方案 C（可选）：React `/admin`（Vite）+ shadcn UI + Milkdown/TipTap

适合：你需要更复杂的 UI/交互（资源管理、扩展块等）。代价：引入 Node 构建链；需要严格映射到现有 suCSS variables，避免风格漂移。

> [REVIEW] 我觉得 D 应该是比较好的方案，不需要一个后端，状态都在 github 上面，我觉得我可以接受引入一个 oauth provider，然后我现在的评论系统也是这样做的呀，你可以看看怎么搞，如果一定要引入 supabase，它应该只是存存草稿，而不是作为真相源存储
> 
> [RESPONSE] 同意你的方向：把 GitHub（Issues/Discussions + repo）作为“状态都在 GitHub 上”的主存储更符合你的偏好；Supabase 如果引入，也应降级为“可选的草稿/缓存”，而不是系统真相源。
> 
> 我这边需要你再确认 2 个点，避免走错：
> 
> 1) **OAuth 形态**：你说“可以接受引入一个 oauth provider（评论系统也是这样）”。评论系统 giscus 的写入是靠 GitHub App/服务端完成 token 交换与签名；如果我们也走传统 web OAuth flow，会涉及 `client_secret` 的保密，通常仍需要一个可信后端/函数来换 token。为满足“不要手写后端”，我更建议用 GitHub OAuth *device flow*：纯前端即可完成授权（不需要后端保管 `client_secret`）。你是否接受 device flow 作为“oauth provider”的替代？
> 
> 2) **草稿存哪里**：
> - D1) GitHub Discussions：每个页面对应一个 discussion，draft 就是 discussion body；发布时生成 PR 写入 `content/**`。
> - D2) GitHub Issues：同理，但 issues 更偏任务流。
> - D3) repo `drafts` 分支：autosave 直接更新文件（会产生较多提交，需做合并/压缩策略）。
> 你更偏好 D1/D2/D3 哪个？
> 
> 我会在你确认后，把“GitHub 真相源 + 草稿策略 + 发布 PR 策略 + 图片提交策略 + 安全模型（token 本地存储/可选私钥加密）”补全为可实现的落地步骤。
> [STATUS:need-info]
> 
> [RESPONSE] 同意并已基于你的最新确认完成收敛：
> - 方案 D（GitHub 为主存储）作为主方案，但不再需要“oauth provider + 后端 token exchange”，改用 **device flow**。
> - Supabase 从主路径移除（如未来需要跨设备草稿/协作，再作为可选组件）。
> 
> 落地含义（供你确认）：
> - `draft/autosave`：只写本机缓存，不产生 Git commit；避免“每敲一个字就产生一次 commit/PR 噪音”。
> - `publish`：一次性把指定 `content/**` 文件 + 图片变更，提交到 GitHub（默认建议开 PR；也可配置为直推 master）。
> 
> 若你认可这个收敛方向，我下一步（等你说可以改代码后）就按此实现。
> [STATUS:resolved]

> [REVIEW] 1. device flow 可以接受. 2. 我觉得要么前端缓存吧，我似乎没啥需要跨设备同步的需求，就别搞那么复杂了。
> 
> [RESPONSE] 收到确认：
> 1) OAuth：采用 GitHub device flow（无 `client_secret` 依赖，无需自建 token exchange 后端）。
> 2) 草稿：只做前端本机缓存（IndexedDB 为主，localStorage 作为兜底/小数据），不做跨设备同步。
> 
> 据此我会把整体设计收敛为：
> - **真相源（published）**：GitHub repo `content/**`（通过 PR/push 写回）
> - **草稿（draft/autosave）**：本机缓存（不需要 Supabase/GitHub Discussions/Issues）
> - **图片**：发布时一并写入 repo（例如 `static/images/uploads/...`），Markdown 引用站内路径
> [STATUS:resolved]

## 推荐落地（基于默认假设）

当前实现直接落地方案 D（无后端）：

1. `/admin/` 静态页面：连接 GitHub（device flow），拉取 `content/**.md` 列表。
2. 加载文件：解析并分离 front matter 与正文；正文用 Vditor 编辑。
3. 草稿：输入时 debounce 保存到本机 IndexedDB（不写 GitHub）。
4. 图片：通过“Insert image”登记为 pending asset，并插入站内路径（`/images/uploads/...`）；发布时一并提交到 repo 的 `static/images/uploads/...`。
5. 发布：创建分支 + PR（一次 commit，包含 Markdown + 图片），合并后触发现有 Zola deploy workflow。

## 安全与风险清单（需要验证/测试）

- 编辑器对 `{{ ... }}`（Zola shortcodes）与 front matter 的保真（尤其 WYSIWYG 模式）。
- XSS：Markdown 中若允许 raw HTML，发布到站点会带来注入风险（需要在“发布前”做规则约束/过滤）。
- GitHub token scope：尽量最小化（public repo 用 `public_repo`）。
- admin 页面索引：需要 `noindex`（或放到不可猜路径/加额外 gate），避免搜索引擎收录。

## 范围

- static/css/*
- templates/*
- static/js/*
- scripts/*
- .github/*
- .legion/**

## 阶段概览

1. **现状审计与约束** - 2 个任务
2. **编辑器选型调研** - 2 个任务
3. **后端与数据模型设计** - 2 个任务
4. **整合方案详细设计与落地计划** - 2 个任务

---

*创建于: 2026-01-06 | 最后更新: 2026-01-06*
