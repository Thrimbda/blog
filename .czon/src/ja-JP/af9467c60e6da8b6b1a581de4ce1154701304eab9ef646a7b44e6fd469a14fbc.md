---
"title": "Zola ブログのリアルタイム編集とバックエンドソリューション設計"
"summary": "このドキュメントは、既存の Zola 静的ブログサイトに WYSIWYG リアルタイム編集機能を追加するための設計案です。まず現状を監査し、サイトの技術スタック（Zola + GitHub Actions デプロイ）と維持すべきデザイン言語（suCSS.css に基づく CSS 変数とテーマ切り替え）を確認しました。中核部分では、複数の Markdown エディタ（Vditor を重点的に推奨）とバックエンドを手書きせずに済むソリューション（Supabase を重点的に推奨）を調査し、それぞれの長所・短所および適合性を比較しました。また、「リアルタイム編集」の具体的な意味、編集範囲、公開フローなど、決定すべき重要な問題を明確にしました。最終目標は、複雑なビルドチェーンを導入せず、既存サイトのスタイルを維持し、Zola のショートコードと Front Matter を安全に処理できる編集・公開システムを設計することです。"
"tags":
  - "Zola"
  - "WYSIWYG"
  - "Markdown エディタ"
  - "Supabase"
  - "静的ブログ"
  - "リアルタイム編集"
  - "Vditor"
  - "ソリューション設計"
"date": "2026-01-06"
---

# Zola ブログ：WYSIWYG Markdown リアルタイム編集 + Supabase/GitHub バックエンドソリューション設計 - コンテキスト

## セッション進捗 (2026-01-06)

### ✅ 完了済み

- 現状の予備監査：プロジェクトは Zola サイトで、テーマは anemone + suCSS を基にしています。現在 JS は極めて少なく、CDN 依存は許可されています。

### 🟡 進行中

- レビュー可能な詳細設計の出力（エディタ/バックエンド選定 + 公開/同期フロー + 実装手順）。

### ⚠️ ブロック/未定

- 「リアルタイム編集」の正確な意味（リアルタイムプレビュー vs 自動保存 vs マルチユーザー協調編集）。
- 編集範囲（少数のページ/単一ファイルのみの編集か、サイト全体のコンテンツか）。
- 公開フロー（下書き保存のみか、`content/` に同期して Zola ビルドをトリガーするか）。

---

## 主要ファイル

- `config.toml`：サイト設定とナビゲーション。デフォルトテーマは light で、多言語をサポート。
- `templates/head.html`：サイト全体で `static/css/reset.css`、`static/css/suCSS.css`、`static/css/style.css`、`static/js/script.js` を読み込み、CDN 経由で `rxjs`、`highlight.js`、`mermaid` を導入。
- `static/css/suCSS.css`：デザイントークン（CSS 変数）と基本コンポーネントのスタイル（フォーム、ボタン、テーブルなど）。light/dark テーマの変数を含む。
- `static/css/style.css`：サイトのカスタムスタイル（ナビゲーション、フッター、スライダー、ショートコードのスタイルなど）。
- `static/js/script.js`：テーマ切り替え（`data-theme` + localStorage）とスライダーのインタラクション。admin ページでも一貫した体験のために再利用可能。
- `content/**`：Markdown コンテンツソース。YAML front matter（`---`）とショートコード（例：`{{ slideshow(...) }}`）を含む。

---

## 主要決定事項

| 決定事項 | 理由 | 代替案 | 日付 |
|------|------|----------|------|
| デフォルトで「純粋な JS admin ページ + Supabase ストレージ/認証」を推奨し、エディタは Vditor を優先評価 | 現在のプロジェクトには Node/React ビルドチェーンが無い。既に CDN 依存の慣例がある。Vditor は WYSIWYG/IR/SV の3モードと「ブラウザサイド Markdown エディタ」という位置付けを提供し、統合コストが最低。 | React + shadcn + Milkdown/TipTap、または GitHub Discussion/Issue をバックエンドとして使用 | 2026-01-06 |

---

## 現状監査要約

### 技術スタック/デプロイ

- サイトは Zola（`config.toml`）を使用。GitHub Actions で `shalzz/zola-deploy-action` を用いて `gh-pages` にデプロイ（`.github/workflows/*.yaml`）。
- サイトは「極小 JS」志向：現在の全サイトスクリプトは `static/js/script.js` のみで、他は CDN（`rxjs`、`highlight.js`、`mermaid`）。

### テーマとデザイン言語（必須で維持）

- ビジュアルは `suCSS.css` の CSS 変数に基づく：`--bg/--bg-light/--text/--text-light/--accent/--accent-light/--link/--border` など。
- テーマ切り替えメカニズム：`document.documentElement[data-theme="light"|"dark"]` で、`prefers-color-scheme` + localStorage と同期（`static/js/script.js` 参照）。
- コンポーネントスタイル：ボタン/フォーム/テーブル/リストマーカーなどは全て `suCSS.css` で定義。新規 UI は、新しいデザインシステムを導入するのではなく、これらのセマンティック要素と変数を優先的に再利用すべき。

### コンテンツ特性（エディタに影響）

- Markdown は以下を含む可能性がある：
  - YAML front matter（例：`content/gcores-talks.md`）
  - Zola ショートコード（例：`{{ slideshow(...) }}`、テンプレートは `templates/shortcodes/*` に配置）
  - ハイライトされたコードブロック、mermaid コードブロック
- リスクポイント：WYSIWYG エディタがショートコードを「理解/レンダリング」しようとすると、原文を書き換えたり、消してしまったりする可能性がある。「未知の構文をそのまま保持する」エディタ/モードを選択するか、エディタ内に「ソースモード」をフォールバックとして提供する必要がある。

---

## エディタ調査（ウェブ + 資料）

> 目標：埋め込み可能、WYSIWYG（リッチテキスト/見たまま編集）をサポートし、Markdown を出力できること。ビルドチェーンが不要（純粋な JS/CDN）であることが望ましい。

| 候補 | 位置付け/モード | 統合形態 | テーマ/カスタマイズ | キーポイント | 本プロジェクトへの適合性結論 |
|---|---|---|---|---|---|
| **Vditor** | ブラウザサイド Markdown エディタ。WYSIWYG/IR(Typora風)/SV 分割表示をサポート | ネイティブ JS。公式サイトと CDN 形態が成熟（ページの文言で3モードを明確に強調） | デフォルトのテーマと設定項目が多い。CSS 変数を通じて suCSS に近づけられる | リアルタイム保存、貼り付け/ドラッグ&ドロップアップロードなどの機能をサポート（公式サイトページの説明参照）。MIT ライセンス（`https://unpkg.com/vditor@3.10.4/LICENSE`） | **最優先推奨**：「ビルドチェーン無し + リアルタイム編集」とのマッチ度が最も高い。「ショートコード/Front matter が破壊されない」ことを重点的に検証する必要あり |
| **TOAST UI Editor** | Markdown/WYSIWYG デュアルモード | CDN（`uicdn.toast.com/editor/latest/...`）または npm | テーマ/スタイル体系あり。カスタム CSS で適合可能 | ドキュメントで CDN と `usageStatistics` の無効化を明確にサポート（`https://unpkg.com/@toast-ui/editor@3.2.2/README.md`） | 代替候補：成熟しているがスタイル体系がより「重い」。suCSS にテーマを適合させるコストが高い可能性あり。ライセンスは統合時に再確認が必要 |
| **Milkdown** | プラグイン化された WYSIWYG Markdown エディタ（Typora スタイル）、ProseMirror + remark | 通常バンドラー（React/Vue など）が必要 | 深くカスタマイズ可能だが、エンジニアリングコストが高い | README で WYSIWYG Markdown という位置付けと MIT ライセンスを明確にしている（`https://raw.githubusercontent.com/Milkdown/milkdown/main/README.md`） | 「React/shadcn を導入する」場合の候補として適している。現在の Zola プロジェクトとは合わない（ビルドチェーンの導入が必要） |
| **TipTap** | リッチテキストエディタツールキット（HTML/Schema 寄り） | React/Vue/Svelte など | カスタマイズ性が高いが、Markdown には追加の変換と制約が必要なことが多い | 公式サイトは「リアルタイムコラボレーション」などを強調しているが、Markdown-first は中核ではない | 第一選択としては推奨しない（Markdown とショートコードのシナリオが複雑） |

---

## バックエンド調査（手書きバックエンド不要）

| ソリューション | 自前サービスの構築が必要か | 認証/権限 | ストレージ/履歴 | Zola 公開との関係 | 結論 |
|---|---|---|---|---|---|
| **Supabase** | 不要（DB/Auth/Storage をホスト） | フロントエンド直結 + RLS。anon key は公開可能 | DB 行レベルの履歴は自前構築が必要（revisions テーブルを作成可能） | 静的サイトに影響を与えるには「リポジトリ/content に同期」する必要がある | **デフォルト推奨**：実装が最も直接的。セキュリティ境界が明確（RLS）。画像ストレージも容易 |
| **GitHub Issue/Discussion** | 理論上はサービス不要だが、実際には OAuth token 交換サービスが必要なことが多い | OAuth フローが複雑（純粋なフロントエンドでは token 交換を安全に処理するのが難しい） | GitHub は自然に履歴/監査機能を持つ | サイトに同期するには、issue/discussion を `content/` に変換するスクリプトが必要 | 代替候補：「コンテンツを GitHub データとして扱いたい」という強い希望があれば検討可能。ただし、認証/アップロード/同期の複雑さが増す |

補足：GitHub Docs の OAuth web flow では、「code を access token と交換する」ステップで `client_id` と `client_secret` の両方を同時に提供することを明確に要求しており、これにより「純粋なフロントエンドが GitHub に直接接続して書き込みバックエンドとする」ことは、セキュリティ上、成立が非常に難しくなります（token 交換サービスを導入するか、device flow などの制限されたソリューションに切り替える場合を除く）。

---

## クイックハンドオーバー

**次回はここから続けます：**

1.  `plan.md` で「リアルタイム編集/編集範囲/公開フロー」に関するデフォルトの仮定と、あなたにレビューが必要な決定事項を確認します。
2.  あなたのフィードバックに基づいて、3つのソリューション（Supabase / GitHub Discussions / React 化）の中から最終的な推奨案と実装手順を固めます。

**注意事項：**

-   あらゆる UI（admin を含む）は、`suCSS.css` の CSS 変数と light/dark メカニズムを再利用し、スタイルを破壊する新しいテーマ体系を導入してはいけません。
-   重点的に検証が必要：エディタが Zola ショートコードと front matter を書き換えないかどうか。

---

*最終更新: 2026-01-06 20:30 by Codex*