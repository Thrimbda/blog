---
"title": "RDD 論文ノート"
"summary": "本稿は、Resilient Distributed Datasets (RDDs) に関する論文ノートであり、RDDが分散システムのメモリ抽象化としての動機、基本特性、利点と制限について詳細に論じています。RDDは、計算の細粒度性を犠牲にすることで、効率的な反復計算、耐障害性、汎用性を実現し、従来の分散計算フレームワークにおけるデータ再利用の性能ボトルネックを解決しました。また、RDDのSparkにおける実装、そのプログラミングインターフェース、依存関係、性能評価を紹介し、反復タスクやユーザー分析プログラムにおいてHadoopと比較して顕著な性能向上を示しています。最後に、RDDの核心的価値はクラスタメモリのモデリングにあり、高速な連続計算を可能にすること、そしてハードウェアの制限がソフトウェア革新の理論的限界であることを指摘しています。"
"tags":
  - "RDD"
  - "Spark"
  - "分散システム"
  - "論文ノート"
  - "メモリ抽象化"
  - "反復計算"
  - "耐障害性"
  - "性能最適化"
"date": "2020-10-29"
---

Resilient Distributed Datasets (RDDs) は、分散システムに対するメモリ抽象化そのものです。

本質的には制約の厳しい**共有メモリ**モデルであり、粗粒度の transformation 操作のみを提供します。

## 動機

### 問題

反復的（iterative）な分散計算には、（効率的な）反復間でのデータ再利用能力が必要です。

### 現状

- 当時（2012年）存在していた分散計算フレームワークには、クラスタメモリを十分に活用（再利用）できる抽象化が欠けていました。
- 既存フレームワークでデータを再利用する唯一の方法は、複数回の分散計算を起動することでした。

したがって、問題の解決可能性はあるものの、データ再利用は依然としてこの種の計算の性能ボトルネックでした。過度に頻繁なI/Oにより大量のリソースが浪費されていました。

これらの問題を解決しようとする研究はいくつかありましたが、特定の計算パターンしかサポートできず、十分に汎用的ではありませんでした。

主な課題は、計算の細粒度性、汎用性、耐障害性の三者間のトレードオフにありました。

## RDD

RDDは、分散計算クラスタに対するメモリ抽象化を提供し、上記の問題を大きく解決しました。その手法は、三者の中で相対的に最も重要でない一点、すなわち計算の粒度を捨てることでした。

### 基本

RDDの特性：

- 不変（Immutable）
- 遅延評価（Lazy）

RDDがサポートする操作：

- transformation - 遅延操作（Lazy operations）
  - map
  - filter
  - ...
- actions - 計算の起動（Launch computations）
  - count
  - collect
  - save
  - ...
- persist（キャッシュ）

SparkはRDDを実装し、DryadLINQに似たプログラミングインターフェースを提供しています。

### RDDの利点

主に、（クラスタメモリをモデリングする）類似の抽象化と比較して、RDDは細粒度のデータ操作を犠牲にすることで、他の側面（汎用性、耐障害性、性能低下時の挙動、一貫性、ストラグラー問題、使いやすさ）において圧倒的な優位性を実現しています。

### RDDの制限

RDDは、大量の細粒度な読み書きを伴う非同期計算（例えば、クローラのストレージシステム）には適していません。類似のアプリケーションに対して著者は他のフレームワークを提案しており、ここでは詳述しません。

## Sparkのプログラミングインターフェース

Scalaで実装されています。その理由は、Scalaが簡潔で効率的であるためです。

この部分では著者がいくつかの例を挙げていますが、ここでは省略します。

## RDDの表現

RDDはDAG（有向非巡回グラフ）で表現されます。

### 依存関係（Dependencies）

- 狭い依存関係（narrow dependencies） - 各親（parent）は最大1つの子（child）に依存されます。
- 広い依存関係（Wide dependencies） - 1つの親（parent）は少なくとも1つの子（child）に依存されます。

## 実装

- クラスタ管理にはMesosを使用。
- ジョブスケジューリングは省略。
- インタプリタ統合は省略。
- メモリ管理は省略。

## 評価

- 反復タスクにおいてHadoopの20倍の性能。
- ユーザー分析プログラムにおいてHadoopの40倍の性能を報告。
- ノード障害後、迅速に再計算可能。
- 1TBのデータクエリで5-7秒の遅延。

詳細は省略。

## 考察

著者らは、RDDの汎用性を示すために、Sparkを用いて他の分散計算フレームワークを模倣するという徹底的な試みを行いました。

具体的な内容は省略。

## まとめ

- RDD/Sparkの最大の利点は、クラスタ全体のメモリをモデリングすることにあり、分散計算が中間結果をメモリ内に保存できるようにします。これにより、同一のDatasetに対する高速な連続計算が可能になります。これらすべては、メモリがハードディスクよりも一桁速いという前提に基づいています（それゆえにSparkがHadoopに対して40倍の性能向上を実現できました）。
  ソフトウェア革新の理論的限界は、ハードウェアの物理的制限にあることがわかります。