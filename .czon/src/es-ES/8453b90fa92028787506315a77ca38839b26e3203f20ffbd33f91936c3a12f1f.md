---
"title": "Renovando el blog: He trasladado mi sección de '机组' al blog"
"summary": "Este artículo detalla el proceso técnico de cómo el autor migró el contenido de su sección '机组' (Gcores) a su blog personal. Comienza con el fallo del blog anterior debido a dependencias obsoletas, describe la selección tecnológica del nuevo blog (usando el generador Zola y un tema simple), y se centra en el flujo completo de extracción de datos de '机组' mediante API, procesamiento a formato Markdown, e implementación de interacciones de galería deslizante con tecnologías frontend (HTML, CSS, JavaScript). El autor enfatiza la alegría del ciclo de retroalimentación rápida en el desarrollo frontend y reflexiona sobre el significado de esta práctica técnica."
"tags":
  - "Blog"
  - "Tecnología"
  - "Desarrollo Frontend"
  - "Web Scraping"
  - "Zola"
  - "Gcores"
  - "Alegría de Programar"
"date": "2024-06-18"
---

**Este artículo nace de mi espíritu infantil que aún no se ha extinguido.**

En abril, durante un viaje, tuve un fuerte impulso de escribir un diario de viaje, que primero publiqué en Gcores. Luego, siguiendo la costumbre, prepararía una versión en formato Markdown para publicarla en mi blog.

Después de editarlo, descubrí que mi blog estaba roto.

## El blog anterior

La moda de crear blogs personales surgió en mi departamento durante mi tercer año de universidad. Hace 7 años, [este artículo](./da-hao-bo-ke-hou-de-yi-dian-hua/) (que me hace retorcerme de vergüenza) describía mis sentimientos iniciales al crear este blog.

Las razones eran, por un lado, querer obligarme a escribir algo; por otro, querer realizar alguna práctica de ingeniería, combinando algunas tecnologías modernas y llamativas que no se enseñan en la universidad; y además, tener un dominio propio era realmente genial, al menos para mí.

Recreemos esa escena:

---

Después de aprender algo nuevo, con emoción, rápidamente anotaba mis ideas en un documento en formato Markdown.

Una vez escrito, ejecutaba con estilo unos comandos para subir el nuevo blog:

```shell
$ git add .
$ git commit -m "¡Nuevo blog! jajajaja"
$ git push origin master
```

Luego, emocionado, abría la interfaz del CI (Integración Continua), que en ese entonces aún era algo novedoso, ya que el concepto DevOps se había propuesto hacía pocos años. En la página de logs del CI, esperaba a que todo el blog, incluido este artículo, se compilara en un sitio web estático HTML, esperaba a que Travis usara mi clave para enviar el artefacto compilado al repositorio git, y esperaba a que Github publicara el artefacto compilado.

Finalmente, entraba a mi dominio [https://blog.thrimbda.com](https://blog.thrimbda.com) y miraba con satisfacción cómo el nuevo artículo aparecía en la parte superior de la página.

---

Con el paso de los años, este proceso se volvió aburrido, aburrido pero efectivo, hasta que llegó el día en que dejó de funcionar.

## El nuevo blog

A finales de abril, reintenté 3 veces el pipeline del CI y todas fallaron. Al revisar rápidamente los logs, descubrí que cierta dependencia de compilación parecía haber desaparecido de internet por ser demasiado antigua. Me di cuenta de lo enorme que es un lapso de 7 años en esta industria, suficiente para que la arena destruya castillos y el mar engulla montañas.

Así que, en los momentos libres del trabajo, con algunas demandas no muy interesantes, hice la selección tecnológica: **suficientemente simple, suficientemente conveniente.**

Así nació este nuevo blog, y como es costumbre, debo presentarlo:

- Elegí [Zola](https://www.getzola.org/) como generador;

- Encontré un [tema](https://github.com/Speyll/anemone) muy simple pero bastante bonito;

Como reemplazo del blog anterior, este nuevo blog estaba listo.

## El proceso de renovación con espíritu infantil

Quizás por ser suficientemente nuevo, o porque la selección tecnológica fue suficientemente simple, o porque el ciclo de retroalimentación del trabajo frontend es suficientemente corto, además de haber absorbido algunos conocimientos frontend trabajando con Azheng, llenando así los vacíos de conocimiento que no estudié con dedicación en mi primer año, el proceso de modificar el blog volvió a ser interesante.

Algunas pequeñas modificaciones de estilo CSS, añadí un nuevo gitcus, alojando la sección de comentarios en Github; coincidí con mi yo de hace siete años: programar y modificar proyectos es realmente algo divertido, es la alegría del trabajo, la alegría del juego.

Quiero aprovechar el impulso de esta alegría para enfocarme (y disfrutar) en el proceso técnico de trasladar mi sección '机组' al blog.

<!--more-->

---

### Datos

En una exploración anterior, descubrí que Gcores es increíblemente amigable con los web scrapers, sus interfaces de datos son muy uniformes y expresivas, por ejemplo, al explorar mi sección '机组':

![gcores-api-at-glance](https://0xc1.space/images/2024/06/18/gcores-api-at-glance.jpg)

Descubrí que esta es la API para solicitar los datos de '机组':

```
https://www.gcores.com/gapi/v1/users/464460/recommend?talk-include=topic%2Cuser%2Chelpful%2Cpoll-options%2Crelated-content.radio%2Crelated-content.video%2Crelated-content.article%2Crelated-content.game%2Crelated-content.film%2Crelated-content.album%2Crelated-content.album-bundle%2Crelated-content.product%2Crelated-content.discussion&original-include=user%2Cdjs%2Ccategory&order-by=time&before=1718720726.986&fields[articles]=title%2Cdesc%2Cexcerpt%2Cis-published%2Cthumb%2Capp-cover%2Ccover%2Ccomments-count%2Clikes-count%2Cbookmarks-count%2Cis-verified%2Cpublished-at%2Coption-is-official%2Coption-is-focus-showcase%2Cduration%2Cdraft%2Caudit-draft%2Cuser%2Ccomments%2Ccategory%2Ctags%2Centries%2Centities%2Csimilarities%2Clatest-collection%2Ccollections%2Coperational-events%2Cportfolios%2Ccatalog-tags&fields[videos]=title%2Cdesc%2Cexcerpt%2Cis-published%2Cthumb%2Capp-cover%2Ccover%2Ccomments-count%2Clikes-count%2Cbookmarks-count%2Cis-verified%2Cpublished-at%2Coption-is-official%2Coption-is-focus-showcase%2Cduration%2Cdraft%2Caudit-draft%2Cuser%2Ccomments%2Ccategory%2Ctags%2Centries%2Centities%2Csimilarities%2Clatest-collection%2Ccollections%2Coperational-events%2Cportfolios%2Ccatalog-tags%2Cmedia%2Cdjs%2Calbums%2Cpublished-albums&fields[radios]=title%2Cdesc%2Cexcerpt%2Cis-published%2Cthumb%2Capp-cover%2Ccover%2Ccomments-count%2Clikes-count%2Cbookmarks-count%2Cis-verified%2Cpublished-at%2Coption-is-official%2Coption-is-focus-showcase%2Cduration%2Cdraft%2Caudit-draft%2Cuser%2Ccomments%2Ccategory%2Ctags%2Centries%2Centities%2Csimilarities%2Clatest-collection%2Ccollections%2Coperational-events%2Cportfolios%2Ccatalog-tags%2Cmedia%2Cdjs%2Clatest-album%2Calbums%2Cis-free%2Cis-require-privilege
```

#### Datos brutos

Resumiendo la información:

```ts
const user = 464460;

const url = new URL(
  `https://www.gcores.com/gapi/v1/users/${user}/recommend?talk-include=topic%2Cuser%2Chelpful%2Cpoll-options%2Crelated-content.radio%2Crelated-content.video%2Crelated-content.article%2Crelated-content.game%2Crelated-content.film%2Crelated-content.album%2Crelated-content.album-bundle%2Crelated-content.product%2Crelated-content.discussion&original-include=user%2Cdjs%2Ccategory&order-by=time&fields[articles]=title%2Cdesc%2Cexcerpt%2Cis-published%2Cthumb%2Capp-cover%2Ccover%2Ccomments-count%2Clikes-count%2Cbookmarks-count%2Cis-verified%2Cpublished-at%2Coption-is-official%2Coption-is-focus-showcase%2Cduration%2Cdraft%2Caudit-draft%2Cuser%2Ccomments%2Ccategory%2Ctags%2Centries%2Centities%2Csimilarities%2Clatest-collection%2Ccollections%2Coperational-events%2Cportfolios%2Ccatalog-tags&fields[videos]=title%2Cdesc%2Cexcerpt%2Cis-published%2Cthumb%2Capp-cover%2Ccover%2Ccomments-count%2Clikes-count%2Cbookmarks-count%2Cis-verified%2Cpublished-at%2Coption-is-official%2Coption-is-focus-showcase%2Cduration%2Cdraft%2Caudit-draft%2Cuser%2Ccomments%2Ccategory%2Ctags%2Centries%2Centities%2Csimilarities%2Clatest-collection%2Ccollections%2Coperational-events%2Cportfolios%2Ccatalog-tags%2Cmedia%2Cdjs%2Calbums%2Cpublished-albums&fields[radios]=title%2Cdesc%2Cexcerpt%2Cis-published%2Cthumb%2Capp-cover%2Ccover%2Ccomments-count%2Clikes-count%2Cbookmarks-count%2Cis-verified%2Cpublished-at%2Coption-is-official%2Coption-is-focus-showcase%2Cduration%2Cdraft%2Caudit-draft%2Cuser%2Ccomments%2Ccategory%2Ctags%2Centries%2Centities%2Csimilarities%2Clatest-collection%2Ccollections%2Coperational-events%2Cportfolios%2Ccatalog-tags%2Cmedia%2Cdjs%2Clatest-album%2Calbums%2Cis-free%2Cis-require-privilege`
);
```

Observando más a fondo, parece que la paginación se determina mediante un parámetro llamado `before`. Simplemente iterando hacia atrás en la marca de tiempo de este parámetro hasta no obtener más datos, podemos obtener el siguiente código:

```ts
import {
  EMPTY,
  Observable,
  expand,
  map,
  mergeAll,
  mergeMap,
  of,
  shareReplay,
  skip,
  takeWhile,
  tap,
  toArray,
} from "https://esm.sh/rxjs@7.8.1";

const user = 464460;

const url = new URL(
  `https://www.gcores.com/gapi/v1/users/${user}/recommend?talk-include=topic%2Cuser%2Chelpful%2Cpoll-options%2Crelated-content.radio%2Crelated-content.video%2Crelated-content.article%2Crelated-content.game%2Crelated-content.film%2Crelated-content.album%2Crelated-content.album-bundle%2Crelated-content.product%2Crelated-content.discussion&original-include=user%2Cdjs%2Ccategory&order-by=time&fields[articles]=title%2Cdesc%2Cexcerpt%2Cis-published%2Cthumb%2Capp-cover%2Ccover%2Ccomments-count%2Clikes-count%2Cbookmarks-count%2Cis-verified%2Cpublished-at%2Coption-is-official%2Coption-is-focus-showcase%2Cduration%2Cdraft%2Caudit-draft%2Cuser%2Ccomments%2Ccategory%2Ctags%2Centries%2Centities%2Csimilarities%2Clatest-collection%2Ccollections%2Coperational-events%2Cportfolios%2Ccatalog-tags&fields[videos]=title%2Cdesc%2Cexcerpt%2Cis-published%2Cthumb%2Capp-cover%2Ccover%2Ccomments-count%2Clikes-count%2Cbookmarks-count%2Cis-verified%2Cpublished-at%2Coption-is-official%2Coption-is-focus-showcase%2Cduration%2Cdraft%2Caudit-draft%2Cuser%2Ccomments%2Ccategory%2Ctags%2Centries%2Centities%2Csimilarities%2Clatest-collection%2Ccollections%2Coperational-events%2Cportfolios%2Ccatalog-tags%2Cmedia%2Cdjs%2Calbums%2Cpublished-albums&fields[radios]=title%2Cdesc%2Cexcerpt%2Cis-published%2Cthumb%2Capp-cover%2Ccover%2Ccomments-count%2Clikes-count%2Cbookmarks-count%2Cis-verified%2Cpublished-at%2Coption-is-official%2Coption-is-focus-showcase%2Cduration%2Cdraft%2Caudit-draft%2Cuser%2Ccomments%2Ccategory%2Ctags%2Centries%2Centities%2Csimilarities%2Clatest-collection%2Ccollections%2Coperational-events%2Cportfolios%2Ccatalog-tags%2Cmedia%2Cdjs%2Clatest-album%2Calbums%2Cis-free%2Cis-require-privilege`
);

const imageUrl = (image: string) =>
  `https://image.gcores.com/${image}?x-oss-process=image/quality,q_90/format,webp`;

// paginación
url.searchParams.set("before", `${Date.now() / 1000}`);

interface IGcoresTalk {
  text: string;
  images: string[];
  published_at: number;
  tags: string[];
}

const rawGcoresTalkData$: Observable<any[]> = of({
  before: Date.now() / 1000,
}).pipe(
  // datos brutos
  expand(async ({ before }) => {
    url.searchParams.set("before", `${before}`);
    const res = await fetch(url);
    const data = await res.json();
    if (!data.data || data.data.length === 0) {
      return EMPTY;
    }
    return {
      before:
        new Date(
          data.data[data.data.length - 1].attributes["published-at"]
        ).getTime() / 1000,
      ...data,
    };
  }),
  skip(1),
  // debug
  // take(1),
  takeWhile((v) => !!v.data),
  // filter((v) => v.data.length > 0),
  tap((v) => {
    console.info(v);
  }),
  toArray(),
  shareReplay(1)
);
```

Así obtenemos un flujo rx que contiene todos los datos brutos de '机组' de un usuario.

#### Procesamiento de datos

Con los datos brutos, el siguiente paso es procesarlos a Markdown. Comencemos directamente, los puntos clave son:

- Decidir qué contenido mostrar.

- Comprender los campos de la interfaz de Gcores.

'机组' es similar a momentos de WeChat o Weibo, básicamente texto con imágenes, más algunas etiquetas. Simplemente los mostraremos en orden.

Los datos de '机组' se pueden definir de la siguiente manera:

```json
{
  "blocks": [
    {
      "data": { "spoiler": false },
      "depth": 0,
      "entityRanges": [{ "key": 0, "length": 1, "offset": 0 }],
      "inlineStyleRanges": [],
      "key": "7u4tf",
      "text": "-",
      "type": "atomic"
    },
    {
      "data": { "spoiler": false },
      "depth": 0,
      "entityRanges": [],
      "inlineStyleRanges": [],
      "key": "wisz4",
      "text": "核聚变好玩，和雨川西蒙合了影，见到了做志愿者的 merz，然而社恐差点没敢上前搭话，腿快走断了，给没能来的小朋友们买了点纪念品，Celeste 随机异变速通震撼我妈，全程硬是没把因为震惊而张开的大嘴合上。可惜周天广州下雨航班被取消所以急匆匆买了深圳回上海的高铁票就没去成周天的。",
      "type": "unstyled"
    },
    {
      "data": { "spoiler": false },
      "depth": 0,
      "entityRanges": [],
      "inlineStyleRanges": [],
      "key": "nzffe",
      "text": "",
      "