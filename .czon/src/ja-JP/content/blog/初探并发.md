---
"title": "並行処理への第一歩"
"summary": "本稿では、筆者が小さな課題を通じて並行プログラミングに触れた経験を紹介します。Pythonのqueue、signal、timeモジュールを使用して、デモ用の並行制御プログラムを作成しました。記事では、これら3つのモジュールの役割を説明しています：queueはメッセージキューとしてシグナルを伝達し、signalはKeyboardInterruptの捕捉に、timeはメインスレッドが割り込みに応答できるようにするために使用されます。さらに、マルチスレッドプログラミングにおけるメッセージキューの重要性について論じ、スレッド間通信の実現とシステムの結合度低減に役立つことを指摘しています。そして、優れたシステム設計とは変化に対応するためにあること、詳細をカプセル化し、イベント駆動によってモジュールを連携させることで実現されると強調しています。"
"tags":
  - "python"
  - "並行処理"
  - "マルチスレッド"
  - "メッセージキュー"
  - "システム設計"
"date": "2017-05-07"
---

---
title: 並行処理への第一歩
date: 2017-05-07
taxonomies:
  tags:
    - python
    - 並行処理
---

最近の小さな課題で、私は初めて実用的な並行プログラミングに触れる機会を得ました。

<!--more-->

## デモ

そこで、Pythonの`queue`、`signal`、`time`モジュールを使って、真のマルチスレッドとは言えないものの、概念を示す小さなデモを作成しました：

```python
# -*- coding: utf-8 -*-
# @Author: Michale
# @Date:   2017-05-04 15:00:41
# @Last Modified by:   Michale
# @Last Modified time: 2017-05-07 00:46:52
import signal
import queue
import time


class TestClass(object):
    queue = queue.Queue()

    def __init__(self):
        signal.signal(signal.SIGINT, self.stopIfPressKill)

    def stopIfPressKill(self, mySignal, stack):
        if mySignal == signal.SIGINT:
            print('you pressed CTRL-C')
            self.queue.put_nowait('stop')
            print(self.queue.qsize())

    def mainThread(self):
        while True:
            time.sleep(1)
            if not self.queue.empty():
                data = self.queue.get()
                print(data)
                if data == 'stop':
                    break
                else:
                    self.queue.put(data)


if __name__ == '__main__':
    yoo = TestClass()
    yoo.mainThread()

```

3つのモジュールの役割を説明します：

- `queue`：メッセージキューとして機能します。このデモでは少々大げさな使い方かもしれません。
- `signal`：`KeyboardInterrupt`を捕捉し、停止シグナルをメッセージキューに投入するために使用します。
- `time`：メインスレッドがこの`KeyboardInterrupt`を捕捉できるようにするために使用します。

## 考え方

マルチスレッドを導入すると、メインスレッド以外のスレッドは起動後に制御が難しくなるため、メッセージキューなどの方法を用いたスレッド間通信が求められるようになります。

しかし、マルチスレッドであるかどうかに関わらず、システムの各モジュールは本来、詳細をカプセル化し、イベントを介して連携動作すべきです。これはシステムの結合度を下げるのに大いに役立ちます。これが優れたシステムの設計思想、すなわち **「変化のために設計する」** ということです。